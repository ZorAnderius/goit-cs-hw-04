АНАЛІЗ ФАЙЛОВИХ ОБ’ЄКТІВ ОПЕРАЦІЙНОЇ СИСТЕМИ WINDOWS 10 ДЛЯ ОЧИЩЕННЯ Й ОПТИМІЗАЦІЇ ПРОСТОРУ СИСТЕМНОГО РОЗДІЛУ


Посилання на оригiнал публiкації

Автори публiкації: Булатецький В.В., Булатецька Л.В., Гришанович Т.О. Волинський національний університет імені Лесі Українки, Луцьк, Україна

Анотація: У роботі проведено аналіз причин та ряд способів вирішення проблеми браку вільного місця на системному розділі в процесі експлуатації операційної системи Windows 10. Досліджено особливості організації розділів носія при встановленні на нього поширених операційних систем Microsoft.

Розглянуто основні системні файлові об’єкти, шляхи до них, їх призначення та роль у використанні простору системного розділу та у функціонуванні операційної системи. Наведено перелік шляхів до файлів та папок, що займають найбільші об’єми на системному розділі, коректно очистивши або налаштувавши які можна зекономити значний простір на системному розділі.

Розглянуто основні інструменти операційної системи для реалізації методів очищення: інтерпретатор командного рядка, середовище PowerShell, засоби редагування системного реєстру та засоби виклику функцій системних бібліотек. Особливу увагу приділено пакетним файлам, як найпростішим та ефективним засобам реалізації автоматизованого використання можливостей системних утиліт, з врахуванням особливостей роботи інтерпретатора командного рядка. Як один із способів маніпулювання об’єктами за допомогою командлетів, розглядається середовище PowerShell, яке здатне не обробляти команди, а генерувати потоки об’єктів, що стосуються цієї команди та формувати їх оброблене представлення за допомогою як командного, так і графічного інтерфейсу. Описана логічна та фізична будова системного реєстру, як одного із засобів керування налаштуваннями Windows. Проведено порівняльний аналіз деяких програмних продуктів, таких як системна консольна утиліта обслуговування образів розгортання і управління ними та ряд безкоштовних програмних засобів. Сформовано перелік функціоналу, який використовується для оптимізації та очистки системного розділу від надмірної інформації. На основі сформованого переліку проаналізовано ефективність використання розглянутих програмних засобів для очистки системного розділу.

Ключові слова: операційна система, системний розділ, оптимізація, надмірні дані, системний реєстр, пакетний файл, PowerShell, інтерпретатор командного рядка


ВСТУП

Постановка проблеми. Сучасна найпоширеніша операційна система Windows в останніх версіях присутня у кількох редакціях, від Starter до Enterprise (в залежності від версій набір може дещо відрізнятись). Проте загалом такі збірки операційної системи носять універсальний характер і призначені для широкого кола користувачів та апаратних засобів, а, відповідно, і для виконання широкого спектру завдань з різними вимогами. З цієї причини ці збірки досить часто містять у собі надмірну кількість файлової інформації. Самі операційні системи є динамічно змінюваними і нарощують кількість системних файлів у процесі експлуатації, що пов’язано з постійним їх оновленням, виправленнями, встановленням додаткових програмних засобів, пристроїв та їх драйверів, створенням резервних копій, збоїв, тощо. Проте розмір системного розділу є скінченним, а, отже, перед користувачем рано чи пізно постане проблема браку вільного місця, що в свою чергу призводить до гальмування роботи системи, неможливості розгортання останніх актуальних оновлень та виправлень, збоїв у роботі тощо. Тому виникає потреба у корегуванні налаштувань та періодичній очистці (англ. сleanup -прибиранні) системного розділу від непотрібної або надмірної файлової інформації, завантажених і встановлених пакетів оновлень та виправлень, драйверів пристроїв, які уже не використовуються, застарілих резервних копій, тимчасових файлів, файлів, пов’язаних з функціями операційної системи, які вже не використовуються тощо. Тобто, виникає потреба в оптимізації системного розділу. [1]

Аналіз останніх досліджень і публікацій. В процесі розвитку операційної системи Windows, починаючи з найдавніших (Windows 3.1, Windows 95...) і аж до Windows XP, розробники дотримувались позиції, згідно якої, на відміну від *nix-систем, всі файли та папки, як системні, так і користувацькі, повинні розміщуватись на одному первинному розділі. Цей розділ повинен бути активним та завантажувальним. Такий підхід в першу чергу був зумовлений особливістю операційної системи MsDos, яка є основою операційних систем Windows аж до Windows Millenium (1999р) включно. АджеMsDos могла повноцінно працювати лише з одним первинним розділом на одному жорсткому диску, розміченому за стандартом MBR (Master Boot Record). Починаючи з початку 90-х паралельно велась розробка операційних сиcтем типу Windows NT, які вже не були надбудовою над MsDos, і, відповідно, не мали пов’язаних з нею обмежень, що стосувались розділів на жорсткому диску. Навіть сучасна Windows 11 базується на коді, що став основою Windows NT. Проте, з міркувань сумісності з попередніми версіями операційних систем на рівні файлової структури, розробники і надалі притримувались принципу «Все на одному розділі». У цьому були свої переваги та недоліки. Одним розділом легше маніпулювати, робити його резервні копії, відновлювати, використовувати єдину файлову систему для усіх даних, використовувати декілька операційних систем (кожна на своєму розділі), тощо. Але в цьому був і основний недолік –у випадку незворотного пошкодження такого розділу, користувачі зазнавали втрат власних даних. Частина OEM-виробників почала використовувати декілька розділів, застосовуючи не вмонтовані в операційну систему програмні засоби для реалізації механізмів відновлення та підвищення стійкості операційної системи до пошкоджень. Такі засоби виробники розміщували на інших розділах. Проте лише з появою Windows Vista, а точніше, із появою підтримки в ній нового стандарту GPT (GUID (Globally Unique IDentifier) Partition Table) розмітки накопичувачів, з’явилась можливість розподілити по розділах (створити їх тепер можна було аж до 128) системні та користувацькі дані [2]. Але, на жаль, розробники і далі за замовчуванням залишають користувацькі та системні дані на одному розділі, залишаючи користувачам можливість та право вибору самостійно переносити власні папки на інші розділи, хоча в процесі встановлення (починаючи з Windows Vista) створюється або використовується більше, ніж один первинний розділ, але призначені вони в основному для підвищення стійкості самої операційної системи.


Так, наприклад, Windows 10 при своєму встановленні створює за замовчуванням 4 розділи на нерозміченому накопичувачі [3]:

    Recovery – зарезервований операційною системою розділ, де зберігаються файли, необхідні для скидання операційної системи до початкового стану, і її завантажувач.
    EFISystem(Hidden from disk management) – використовується для запису завантажувачів операційних систем, які (завантажувачі) пов’язані через UEFI(заміна базової системи введення-виведення (BIOS)).
    MSR – захищений розділ Microsoft до 128 Мб, створений для резервування частини простору з можливим подальшим використанням операційною системою Windows, встановленої в іншому окремому розділі.
    C: Drive – основний системний розділ.

Оскільки в більшості випадків звичайні користувачі не приділяють значення місцю розміщення власних даних (або просто немають навиків їх переміщення), то на системному розділі накопичується ряд непотрібних користувацьких файлів. При цьому виникає потреба періодичної оптимізації системного розділу шляхом його очищення (прибирання) як від зайвих користувацьких файлів, так і від файлових даних самої операційної системи, які утворюються в процесі її експлуатації та оновлення [4].

Операційна система містить у собі засоби для прибирання (cleanmgr та ін.) та їх зазвичай виявляється недостатньо. Не завжди, або не вчасно, вони спрацьовують в автоматичному режимі або користувачі не мають до них доступу. Тому користувачі часто використовують стороннє програмне забезпечення або здійснюють прибирання та налаштування вручну [1].

Метою статті є розглянути структуру файлів і папок операційної системи та їх роль в її функціонуванні; проаналізувати умови та підібрати методи для зменшення розміру системного розділу, шляхом видалення деяких системних файлів та папок, або визначити налаштування для оптимізації їх розміру. Проаналізувати існуючі програмні продукти, приховані від звичайного користувача утиліти, сторонні утиліти для очистки та оптимізації системного розділу.


РЕЗУЛЬТАТИ ДОСЛІДЖЕННЯ

Вміст системних каталогів операційної системи Windows 10 та їх призначення.

Наведемо перелік основних системних каталогів досліджуваної операційної системи та їх призначення. З самого початку зазначимо, що %systemroot% –системна змінна, що позначає каталог Windows у корені системного розділу (те саме що і %windir%, не плутати з %systemdrive%, яка позначає корінь системного розділу). Поза всіма сумнівами це найважливіша папка, розміщена на активному розділі жорсткого диску. У ній зберігаються всі виконувані файли операційної системи, драйвери, модулі та ін. Варто зазначити, що в деяких випадках дана папка може мати іншу назву. Це трапляється в тому випадку, якщо користувач її замінив в процесі встановлення операційної системи. Тому, якщо її назва наперед невідома, в шляхах можна використовують саме %systemroot%, або %windir%.

Оскільки нас цікавлять папки порівняно великого розміру та папки, які впливають на вивільнення простору системного розділу, то лише на них закцентуємо свою увагу.

%Systemroot%\INF\ – включає в себе всі встановлені на комп’ютері INF-файли, що стосуються наперед визначених стандартних пристроїв –як реальних, так і віртуальних. Дана папка прихована.

%Systemroot%\Installer\ – зберігає більшість з пакетів установників Windows, які коли-небудь інсталювали на комп’ютер. Якщо необхідно встановити або перевстановити програмне забезпечення, що інсталюється за допомогою MSI-пакетів, і при цьому інсталяційний диск відсутній (але раніше таке програмне забезпечення уже встановлювалось), то можна спробувати знайти відповідний інсталяційний файл в цій папці. За замовчуванням вона прихована, а пакети, які в ній містяться, мають числові номери (але не реальні назви), тому найпростішим способом визначити приналежність пакета є використання опцій вкладки «Додатково» діалогу «Властивості пакета». [5]

%Systemroot%\LastGood\(або \LastGood.TMP\) – якщо в системі присутня ця папка, то вона може зберігати резервні копії різних файлів, які пов’язані з останнім вдалим запуском системи.

%Systemroot%\System32\DllCache\ – містить копії всіх системних файлів Windows (не тільки бібліотек, а й програм) і є необхідним при пошкодженні або несанкціонованій системою зміні оригінального системного файлу для його перевстановлення. Даний каталог стиснутий і прихований.

У папці %Systemroot%\System32\drivers\ знаходяться файли драйверів працюючих пристроїв. Проте існує також споріднена папка %Systemroot%\System32\DriverStore\, яка є сховищем драйверів, в тому числі застарілих версій та непрацюючих на даний момент пристроїв.

У папці %Systemroot%\system32\config\ містяться файли, які працюють з реєстром:

    файл AppEvent.Evt є журналом подій додатків, що використовується реєстром Windows;
    файл SAM містить розділ реєстру HKLM\SAM;
    файл SecEvent.Evt є журналом подій безпеки, використовуваного реєстром Windows;
    файл SECURITY містить розділ реєстру HKLM\SECURITY;
    файл software містить розділ реєстру HKLM\Software;
    файл SysEvent.Evt є журналом подій системи, що використовується реєстром Windows;
    файл system містить розділ реєстру HKLM\System.

Папка %Systemroot%\system32\DriverStore\ являє собою сховище драйверів пристроїв. Тут містяться драйвери пристроїв, які працюють на даний момент, і драйвери пристроїв, які на даний момент не працюють або тимчасово відсутні у системі і підключаються за необхідності. Особливої уваги заслуговує підкаталог FileRepository, в якому містяться як актуальні драйвери пристроїв, так і попередні (застарілі) їх версії. Файли у цьому каталозі призначені для «відкату», тобто повернення їх у систему у випадку, якщо актуальний драйвер, на відміну від попередньої своєї версії, пристрою працює некоректно [6], [7].

%Systemroot%\SysWOW64\ – аналог папки system32 для 64-розрядних версій операційних систем. Саме до цієї папки звертається в першу чергу операційна система в пошуках штатних утиліт та інтерпретаторів різноманітних скриптів, сценаріїв тощо.

%Systemroot%\WinSxS\ – призначена для збереження резервних копій системних файлів під час здійснення оновлень операційної системи. При чому така папка містить також жорсткі посилання на такі системні файли, які можуть бути розміщення за іншими шляхами у системі і на даний момент навіть можуть використовуватись операційною системою. Підпапка \Backup використовується для тимчасового збереження файлів розпакованих оновлень під час їх установки і в подальшому може бути використана для відміни таких оновлень [8], [9], [10].

У корені системного розділу розміщені папки \Program Files, \Program Files(x86), призначені для збереження файлів 64-та 32-розрядного встановленого програмного забезпечення, відповідно, в тому ж числі і UWP (плиткових) застосунків разом із їх резервними копіями попередніх та видалених версій.

За шляхом %SystemDrive%\System Volume Information\ розміщено приховану системну папку. Вона містить інформацію для бази даних служби індексування вмісту, що прискорює пошук файлів, службу тіньового копіювання розділів для резервного копіювання, та бази даних служби відстеження розподілених посилань, які використовуються для відновлення ярликів і посилань.

У корені системного розділу можуть міститись також системні файли великого розміру, такі як hiberfil.sys – пов’язаний з режимом гібернації та pagefile.sys і swapfile.sys – пов’язані із віртуальною дисковою пам’яттю операційної системи (swap-файли або файли підкачки). Такі файли створюються при увімкнених відповідних режимах роботи: режим гібернації – передбачає збереження даних з оперативної пам’яті у файл для можливості повного вимкнення живлення з подальшим швидким відновленням стану системи при увімкненні живлення; віртуальна дискова пам’ять –дозволяє за рахунок файлів розширити об’єм оперативної пам’яті до необхідного у випадку її нестачі для запуску тих або інших процесів.

І нарешті %SystemDrive%\Users\, яка містить дані користувачів, зареєстрованих (в тому числі і локально) у системі. Це і файли налагодження програмного забезпечення для кожного конкретного користувача: кеші, тимчасові файли працюючих пакетів; і документи користувача: текстові файли у вигляді документів різного формату, зображення, відео, звукові файли, файли завантажені з мережі; і синхронізовані папки хмарних сховищ користувачів, якщо такі використовуються.

Це перелік далеко не усіх системних файлів та папок, які містяться на системному розділі, але вищеописані – це ті з них, які займають порівняно великі об’єми і найбільше вливають на розмір вільного простору на системному розділі.

Визначившись із причинами зменшення вільного простору в системі, локалізувавши на розділі системні файли та папки великого розміру, необхідно підібрати способи і, відповідно, інструменти зменшення їх розміру.

У переважній більшості сама операційна система містить такий інструментарій і надає механізми вирішення проблеми. Проте на даному етапі такі інструменти є ще досить далекі від ідеальних, існують переважно у вигляді консольних утиліт операційної системи, недоступні безпосередньо через графічний користувацький інтерфейс, вимагають використання ключів та параметрів у своїй роботі, а, отже, і додаткових знань. Крім того такі консольні утиліти можуть виконуватись в окремих середовищах, для функціонування яких необхідне використання інтерпретатора командного рядка (cmd), або оболонки з розширеними можливостями PowerShell.


Інтерпретатор командного рядка, як основний інструмент для роботи з консольними утилітами операційної системи.

Незважаючи на простоту використання графічного інтерфейсу користувача Windows (GUI), інтерфейс командного рядка залишається корисним способом виконання багатьох завдань обслуговування, конфігурації та діагностики операційної системи. Багато важливих інструментів доступні тільки з командного рядка. І хоча термін «bat-файл» може видатись пов’язаним із операційною системою MS-DOS, bat-файли та програмні скрипти залишаються потужними інструментами, що надають ефективний спосіб інкапсулювати в собі загальні функції управління. Утиліти командного рядка, bat-файли та скрипти, засновані на WSH (Windows Script Host) разом надають повний набір будівельних блоків, з яких можна створити високорівневі утиліти для виконання складних завдань [11].

Основою для відображення роботи інтерпретатора командного рядка є вікно, яке реалізує командний інтерфейс операційної системи у вигляді так званого запрошення командного рядка (Command Prompt), в якому власне і виконуються консольні застосунки. Тому часто таке вікно називають консоллю інтерпретатора командного рядка операційної системи. Таке вікно призначене як і для введення команд вручну, в інтерактивному режимі, так і для відображення перебігу виконання консольних програм та команд. А при виконанні неконсольних команд викликаються вікна графічного інтерфейсу поточної виконуваної команди або програми.